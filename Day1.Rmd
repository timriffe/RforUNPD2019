---
pagetitle: "Day 1"
title: | 
  | Introduction to R for Demographers
  | \vspace{1.5cm} \LARGE\emph{Workshop outline}
author: |
  | United Nations Population Division
  | 19-23 August, 2019
  | Tim Riffe
  | Max-Planck-Institute for Demographic Research
date: "19 August, 2019"
output:
  html_document:
    number_sections: yes
    toc: yes
params:
  output_dir: "../RforUNPD2019/docs"
header-includes:
- \usepackage{titling}
- \pretitle{\begin{center}\includegraphics[trim=0 0 0 8cm, width=6cm, ]{assets/MPIDR_square_color.pdf}\\[\bigskipamount]}
- \posttitle{\end{center}}
---

<a href="https://github.com/timriffe/RforUNPD2019" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# About me
				
Hi, I'm Tim Riffe, a US-American, [CED](https://ced.uab.cat/)-educated (Spain) demographer living in Germany and working at the [MPIDR](https://www.demogr.mpg.de/en/). I've been hooked on `R` since 2009 when I did [EDSD](https://www.eds-demography.org/), and have since authored several packages, mostly that do demographic things, but sometimes that do plotting things, and I've even written a [package](https://github.com/timriffe/DemoTools) or [two](https://github.com/timriffe/DDSQLtools) for you ([with help](https://github.com/timriffe/DemoTools/graphs/contributors) of course). My own research data preparation, analyses, analytic plotting, and presentation-quality plotting are all done in `R`. I've led [workshops](https://github.com/timriffe/BSSD2019Module1) and [courses](https://github.com/timriffe/DemoED) such as this one, but yours will be unique and more ambitious.
				
# About this workshop

In the past `R` introductions such as this were done exclusively using the tools of so-called base-`R`, with the objective of putting new users on the path to programming. Nowadays it is becoming more common to teach intro to `R` from a data analyst perspective, namely to use the already-implemented tools and frameworks of `R` to just get things done efficiently without really needing to get into the nitty gritty of programming. Such courses tend to use the [tidyverse](https://www.tidyverse.org/) framework 

Your route to being an `R` data analyst/visualizer could be via Base programming, as it was for me, but it is a longer road than simply jumping into the `tidyverse`. I will try to give you introduction to both things.

So this is what we're going to do: Today we'll go through some very basic basics and then dip into the tidyverse approach, and then in following sessions we'll shift gears to base-`R` programming in order to introduce some concepts that will augment your abilities and ultimately your experience of `R`. These will most importantly include function-writing, loops, and conditional execution. New concepts will be introduced in an interactive type-along way. After a few examples of each new concept, I'll always try to loop back to the *tidy* approach, slipping in new tidy concepts. 

This is an absolute intro course, I don't expect you'll have any experience with `R` or have even heard of these concepts. I do expect that you're familiar with other statistical packages or programming languages at an advanced level, so I'll try to use analogies where possible. I expect you'll be able to keep up if you type along and take notes as we go, and if you ask questions and tell me to stop, slow down, or repeat when needed. Real learning will happen when you try to apply these concepts on your own, and for this reason I'll give afternoon exercises, which we'll then solve together. Often I will set myself up for apparent failure by not having worked through a solution in advance, and you'll see me induce errors and use help resources in a natural way. It's important to see this messy side of programming so that you also learn to make natural use of such resources.

# `R` and the `Rstudio` environment

`R` is a language. You should download and install the latest version from here:
[https://cran.r-project.org/](https://cran.r-project.org/) -- pick the one that runs on your operating system.

`R` is simple and lightweight. It's possible to work directly in its console, or even from the terminal, but we'll instead use a very user-friendly application to interract with it:

`Rstudio` is an application. You should download and install the latest version from here:
[https://www.rstudio.com/products/rstudio/download/](https://www.rstudio.com/products/rstudio/download/) -- again, look at the OS specs and pick the one that pairs well with your operating system.

`Rstudio` is many things at once. It is a file manager, a script editor, a document editor, an instance of `R`, a data viewer, even a web browser. This is where we'll do everything. We will be working often in the form of `R`*markdown* documents, which allows us to mix code, output, and text in a single file. This very document was written in `R` markdown, and it can generate nice-looking documents in Word, html, or pdf (I'm not exactly taking advantage of all its bells and whistles). We'll get started right away with this. The other way we'll write code is in `R` scripts, which are just text files with the `.R` or `.r` file extension.

\begin{center}
*** Brief intermission for Rstudio tour and demonstration ***
\end{center}

TO-DO list for the demonstration:
1. Rstudio panes and tabs
2. arithmetic in the console
3. start a `.project` for this workshop
4. make a folder for Day 1, Monday
5. make a new `R` markdown file for this session
6. show how to use `R` from markdown
7. knit
8. yell hurrah

Much of the `R` interaction we do in this first week of the workshop will be *from* Rmarkdown. This will become second nature, and you can take that with you. I'll comment other Rstudio features as we go.

# `R` basics

## `R` sessions
We often speak of `R` sessions, a given interactive instance of `R`. For the most part `R` sessions are in-memory. If you have a dataset (or many) loaded into a session, then these are stored as *objects* in your workspace or *environment*. You can have a clean or a cluttery environment. You can take a look at what's in your environment in the `environment` tab of Rstudio (upper right corner by default). When you close an instance of `R` you can save your environment as-is, or you can lose it. I recommend *not* saving it. Otherwise you'll end up with lots of file baggage. It's more efficient and less bug-prone to save code and data in files than to save a bunch of saved `R` sessions. You can wipe your session free in Rstudio by selecting `Restart R` under `session` tab, or `Ctrl + Shift + F10`, or by executing `rstudioapi::restartSession()` in the console.

## `R` is functional
`R` is a *functional* programming language. You can think of functions in different ways-- they're like the way functions are used in mathematics, $f()$, or you could think of them as little programs. You give the function input (data, instructions), and then it does something with that and returns output.

Here's a cheap example:
```{r}
sum(1,2,3,4)
```
*sum* is just the name of the function instead of $f()$, and just the same, we enclose its inputs in round parentheses. `R` has many many such functions available to you. They can be combined in many many ways, and you can write your own functions too. If you get the hang of it, you'll find that functions can help you structure thought and analyses. We'll learn a lot about them later this week, but we'll start using them today without thinking about it much. We call `R` a functional language because everything gets done in `R` using functions, and because functions always behave consistently: a given set of inputs (arguments) always returns the same output.

## `R` uses *objects*
In an interactive `R` session, you can have different pieces of data, *objects*, and `R` has different kinds of these, most of which are data structures. 

1. `vector`s store a single data type.
2. `matrix` or `array`s are higher dimensional vectors.
3. `data.frame`s (and many similar things) are tables, each column is a vector, but the columns can be different data types.
4. `list`s are hierarchical data structures, where neither dimension nor data type need to be uniform.
5. `function`s aren't data, but they are objects

And many more...

Today we'll use `vector`s and `data.frame`s, and some nuanced cousins of the `data.frame`.

## Creating objects
You can make an object by *assigning* (`<-`) to its name, like this:
```{r}
a <- 2
```
Now we have a scalar, a vector with one element. This element consists in the integer value 2. The new object is called `a`. Not `A`! **`R` is case sensitive**. You can see `a` pop up in the environment tab, with some extra meta information. `a` can be used like so:
```{r}
a+1
a^2
```
You can also remove `a` like so:
```{r}
rm(a)
```

## More on functions
You can also assign the output straight from a function. For example:
```{r}
nums <- rnorm(n = 10, mean = 0, sd = 1)
nums
```
Here we have created a new object `nums` by assigning the output of the function `rnorm()` (ten random draws from a standard normal distribution). See how we use `rnorm()` there? This function has three *arguments* (i.e. parameters), in this case intuitively named if you've ever taken an intro statistics class. Now the object `nums` is simply available to use throughout the remainder of this `R` session, yay. 

## Reading help files
You can learn about a particular function in different ways. `R` functions are usually documented, and we can see the help file by typing `?` in front of the function name in the console:
```{r, eval = FALSE}
?rnorm
```
Do this live and see how the help page opens by default in the lower right pane in `Rstudio`. Such help pages are structured, and it's worth learning their basic parts so you can make good use of them. The **Description** section tells you the purpose, and is short and to the point. The **Usage** section tells you how a function *call* might look like if all arguments are used. For `rnorm()` we see `rnorm(n, mean = 0, sd = 1)`. From this we learn that `n` is a necessary argument, whereas `mean` and `sd` have default values of 0 and 1, and are therefore *optional* arguments. You can get more information about what's expected of the arguments in the **Arguments** section. The **Details** section gives further information on methods and other things you might want to be aware of. The **Value** section describes function output, and it might be structured. The **Examples** section is probably the most immediately useful, as it gives working examples that often gives hints on how to set things up to effectively use the function.

Even so, sometimes help files are terse. If the reason you're reading them is an error or warning, then you can often find answers in [Stack Overflow](https://stackoverflow.com/questions/tagged/r). You can also save yourself the trouble of copying and pasting error messages into a search engine by using the `searcher` package.

TO BE CONTINUED.

## the gapminder `data.frame`
Let's work with a nicely formatted `data.frame`. These are like a rectangular spreadsheet, or like a dataset in `Stata`: `data.frame`s have rows and columns, and there can be different kinds of data between columns, but only one kind of data within a column.

Let's get a `data.frame` to play with: Hans Rosling's famous data, which you can get as follows: First we download and install an `R` package (library) called `gapminder` using the function `install.packages()`. You only need to do this once to get the package.

```{r, eval = FALSE}
install.packages("gapminder")
```

`R` has thousands of packages, built by developers and users alike. Many packages are even written by researchers to make research easier. `R` has a big community of users and developers: let's find it in different places online...

\begin{center}
*** Time-out to find the `R` community ***
\end{center}

So some people created `gapminder` somewhere, uploaded it to `R`'s central repository, and then we installed it on our machines straight from an `R` session. Now you can load the package using the `library()` function. This loads the contents of the package into memory, i.e. makes them objects in your `R` session. The main object in this package is a `data.frame` called `gapminder`. There are different ways to take a look at it. 

```{r}
library(gapminder)
```

\begin{center}
*** Clicky demonstration of viewing data ***
\end{center}

Or you could get metadata about the object from `str()` (structure). This tells us that we have 1704 observations (rows) of 6 variables, and then it tells us the variable (column) names, what kind of data it is (`Factor` = categorical, `int` = integer, `num` = numeric), and a sample of the first few observations in each.

```{r}
str(gapminder)
```

We will mostly work with `data.frames` or data-frame-like objects. To do so, we'll use the *tidyverse* toolkit, which is a collection of packages, so let's make sure we get that installed and loaded.

```{r, eval = FALSE}
install.packages("tidyverse")
```

```{r, message = FALSE}
library(tidyverse)
```
# *tidy* data


